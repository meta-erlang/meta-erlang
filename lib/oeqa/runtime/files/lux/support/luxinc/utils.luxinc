[macro check-exitcode code]
    ?SH-PROMPT
    !echo ==$$?==
    ?==${code}==
    ?SH-PROMPT
[endmacro]

[macro ok]
    [my tmp=$LUX_FAIL_PATTERN]
    ?SH-PROMPT
    -==[1-9][0-9]*==
    !echo ==$$?==
    ?==0==
    ?SH-PROMPT
    -$tmp
[endmacro]

[macro not-ok]
    [my tmp=$LUX_FAIL_PATTERN]
    ?SH-PROMPT
    -==0==
    !echo ==$$?==
    ?==[1-9][0-9]*==
    ?SH-PROMPT
    -$tmp
[endmacro]
